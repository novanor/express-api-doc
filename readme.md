# Auto generated express documentation
This module is used for autogeneraton of API documentation in Node Express projects.

**With it you can:**
 * autogenerate API documentation as a single HTML page;
 * enable tracking of requests to be used as examples in the apidoc;
 * add route metadata as part of your express app route definitions.

### To create documentation:
**1. Put this code in a `generateApiDoc.js` file in your project:**
```javascript
// Import your express app
const app = require('../../index');
const {ApiDocGenerator} = require('express-api-doc');

const config = {
    // baseUrl: '',
    meta: {
        // Title and description are inserted as is in the template, so you can
        // use simple HTML and bootstrap classes to format them.
        title: 'Citizen Support API',
        'description': 'This is a REST API that is used for ...',
    },
    paths: {
        apidoc: './public/apidoc/index.html', // output
        template: './public/apidoc/template/template.html',
        examples: './public/apidoc/examples/examples.json',
    },
};

const apiDocGenerator = new ApiDocGenerator(app);
apiDocGenerator.generate(config);

// eslint-disable-next-line no-console
console.log('\nDocumentation created successfully.');
```
**2. Run as a script from console:**
```bash
$ node generateApiDoc.js
```
**3. Serve the created apidoc to the user, e.g.:**
```javascript
const path = require('path');
...
app.get('/apiDoc', (req, res) => {
    // Path to the generated apidoc HTML page
    res.sendFile(path.join(**dirname, '../public/apidoc', 'index.html'));
});
```

**4. Template**
The `generate()` function uses the template generated by this project - [express-api-doc-template](https://github.com/forestlake/express-api-doc-template)

### Express app with in-code route metadata
If you want to write route metadata in the code you can use the `expressForApidoc()` generator function instead of the traditional `express()`.
```javascript
const {expressForApidoc} = require('express-api-doc');
...
const app = expressForApidoc();
...
app.get('/', (req, res) => {
    res.json({message: 'It works!'});
}, {
    description: 'Used to test if the API is alive',
});
```
For this to work the metadata object has to be the last argument in the route definition. It will be added in the `app` object as `app.routesMeta[path][method] = metaObject`, e.g.:
```json
"routesMeta": {
    "/test": {
        "get": {
            "description": "Used to test if the API is alive"
        }
    },
    "/person": {
        "post": {
            "description": "Used to create a person"
        }
    }
}
```
### To track requests and responses:
Tracking is used solely to record req/res examples for each route. They are shown in the apidoc generated with the ApiDocGenerator. For this to work it's imperative that the `examples.js` path is the same for the `trackExamples()` and `generate()` functions.

This is especially convenient if you have coverage tests.

**NOTE: For this to work enable example tracking before any route definitions in your app.**
```javascript
const express = require('express');
const {
    expressForApidoc,
    trackExamples,
} = require('express-api-doc');
...
const app = expressForApidoc();
// OR
const app = express();
...
// Uncomment to enable example tracking
trackExamples(app, {
    // Make sure the path is the same as in generateApiDoc
    path: './public/apidoc/examples/examples.json',
});
...
// Route and method definitions
```
**To stop the tracking, just comment out the code**

### Preview of list of available routes:
![list](https://github.com/forestlake/express-api-doc/blob/master/images/list.jpg?raw=true)
### Preview of sendbox with example:
![sendbox](https://github.com/forestlake/express-api-doc/blob/master/images/sendbox.jpg?raw=true)
