# Auto generated express documentation
This module is used for autogeneraton of API documentation in Node Express projects.

**With it you can:**
 * autogenerate API documentation as a single HTML page;
 * enable tracking of requests to be used as examples in the apidoc;
 * add route metadata as part of your express app route definitions.

### To create documentation:
**0. Get a template**

The `generate()` function uses the template generated by this project - [express-api-doc-template](https://github.com/forestlake/express-api-doc-template)

**1. Record some examples**

This is optional but recommended. See [Track examples](#to-track-requests-and-responses).

**2. Serve the apidoc**

The apidoc is created on the fly, so you can serve it like so:
```javascript
const path = require('path');
const {ApiDocGenerator} = require('express-api-doc');

const config = {
    // baseUrl: '',
    meta: {
        // Title and description are inserted as is in the template, so you can
        // use simple HTML and bootstrap classes to format them.
        title: 'Citizen Support API',
        description: 'This is a REST API that is used for ...',
    },
    paths: {
        // Path to the template
        template: './public/apidoc/template/template.html',
        // Path tot he recorded examples
        examples: './public/apidoc/examples/examples.json',
    },
};

module.exports = function (app) {
    app.get('/apiDoc', (req, res) => {
        const apiDocGenerator = new ApiDocGenerator(app);

        res.send(apiDocGenerator.generate(config));
    });
};
```

### Express app with in-code route metadata
If you want to write route metadata in the code you can use the `expressForApidoc()` generator function instead of the traditional `express()`.
```javascript
const {expressForApidoc} = require('express-api-doc');
...
const app = expressForApidoc();
...
app.get('/test', (req, res) => res.json({message: 'It works!'}), {
    description: 'This is a test endpoint for both test requests and test apidoc :)',
    requestParams: {
        reqParam1: 'example description for reqParam1',
        reqParam2: 'example description for reqParam2',
    },
    responseParams: {
        resParam1: 'example description for resParam1',
    },
    notes: {
        note1: 'Just for bereket let\'s add a note for this route',
    },
});
```
For this to work the metadata object has to be the last argument in the route definition. It will be added in the `app` object as `app.routesMeta[path][method] = metaObject`, e.g.:
```json
"routesMeta": {
    "/test": {
        "get": {
            "description": "This is a test endpoint for both test requests and test apidoc :)",
            "requestParams": {
                "reqParam1": "example description for reqParam1",
                "reqParam2": "example description for reqParam2"
            },
            "responseParams": {
                "resParam1": "example description for resParam1"
            },
            "notes": {
                "note1": "Just for bereket let's add a note for this route"
            }
        }
    },
    "/person": {
        "post": {
            "description": "Used to create a person",
        }
    }
}
```
### To track requests and responses
Tracking is used solely to record req/res examples for each route. They are shown in the apidoc generated with the ApiDocGenerator. For this to work it's imperative that the `examples.js` path is the same for the `trackExamples()` and `generate()` functions.

This is especially convenient if you have coverage tests.

**NOTE: For this to work enable example tracking before any route definitions in your app.**
```javascript
const express = require('express');
const {
    expressForApidoc,
    trackExamples,
} = require('express-api-doc');
...
const app = expressForApidoc();
// OR
const app = express();
...
// Uncomment to enable example tracking
trackExamples(app, {
    // Make sure the path is the same as in generateApiDoc
    path: './public/apidoc/examples/examples.json',
});
...
// Route and method definitions
```
**To stop the tracking, just comment out the code**

### Preview of list of available routes:
![list](https://github.com/novanor/express-api-doc/blob/master/images/list.png?raw=true)
### Preview of route info page with examples:
![sendbox](https://github.com/novanor/express-api-doc/blob/master/images/route.png?raw=true)
