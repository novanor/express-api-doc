# Auto generated express documentation
This module is used for autogeneraton of API documentation in Node Express projects.

**With it you can:**
 * autogenerate API documentation as a single HTML page;
 * enable tracking of requests to be used as examples in the apidoc;
 * add route metadata as part of your express app route definitions.

### To create documentation:
**0. Get a template**

The `generate()` function uses the template generated by this project - [express-api-doc-template](https://github.com/forestlake/express-api-doc-template)

**1. Record some examples**

This is optional but recommended. See [Track examples](#to-track-requests-and-responses).

**2.1 Serve the apidoc as web page**

The apidoc is created on the fly, so you can serve it like this:
```javascript
const path = require('path');
const {ApiDocGenerator} = require('express-api-doc');

const config = {
    postmanCollectionId: '3357681-bc1936ab-bc2b-c144-6b63-e8016f843b86',
    meta: {
        title: 'Civi API',
        description: `This is a REST API for the **Citizen Support project**.
Most routes use token authentication. See the \`/auth\` routes for more info.`,
    },
    paths: {
        template: './public/apidoc/template.html',
        examples: './public/apidoc/examples.json',
    },
    // Routes to skip for tracking and apidoc generation
    skip: ['/apidoc', '/apiDoc', '/bootstrap.min.css.map', '/favicon.ico'],
    trackerWarning: '\x1b[41mBEWARE\x1b[0m The request tracker is turned on! This is a dev only option!',
};

app.get('/apiDoc', (req, res, next) => {
        const apiDocGenerator = new ApiDocGenerator(app);

        res.send(apiDocGenerator.generate(config));
});
```

**2.2 Get a Postman importable JSON**

You can also get a JSON that can be imprted into Postman. It represents a single
Postman collection and you can use the in app or web view to view the Apidoc.

**Note :** You can use `Markdown` for all descriptions. It is supported in Postman.

```javascript
const path = require('path');
const {ApiDocGenerator} = require('express-api-doc');

config = {...}

app.get('/apiDoc/postmanImport.json', (req, res, next) => {
    const apiDocGenerator = new ApiDocGenerator(app);

    res.set('Content-Type', 'application/json');
    res.send(apiDocGenerator.getJsonForPostmanImport(config));
});
```

### Express app with in-code route metadata
If you want to write route metadata in the code you can use the `expressForApidoc()` generator function instead of the traditional `express()`.<br>
**Note:** For this to work the metadata object has to be the last argument in the route definition. It will be added in the `app` object as `app.routesMeta[path][method] = metaObject`

```javascript
const {expressForApidoc} = require('express-api-doc');
...
const app = expressForApidoc();
...
app.get('/test', (req, res) => res.json({message: 'It works!'}), {
    description: `With this endpoint you can test if the API is alive.<br>
**Note:** This is also used to demonstrate the apidoc capabilities,
so treat the params descriptions only as examples.`,
    headerParams: {
        language: 'This is a `language` param',
        'x-brand': 'Most routes requre `X-Brand` header to work',
    },
    bodyParams: {
        id: 'Just an **ID**, I don\'t know what for :)',
    },
});
```

### To track requests and responses
Tracking is used solely to record req/res examples for each route. They are shown in the apidoc generated with the ApiDocGenerator. For this to work it's imperative that the `examples.js` path is the same for the `trackExamples()` and `generate()` functions.

This is especially convenient if you have coverage tests.

**NOTE: For this to work enable example tracking before any route definitions in your app.**
```javascript
const express = require('express');
const {
    expressForApidoc,
    trackExamples,
} = require('express-api-doc');
...
const app = expressForApidoc();
// OR
const app = express();
...
// Uncomment to enable example tracking
trackExamples(app, {
    // Make sure the path is the same as in generateApiDoc
    path: './public/apidoc/examples/examples.json',
});
...
// Route and method definitions
```
**To stop the tracking, just comment out the code**
